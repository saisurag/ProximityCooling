C51 COMPILER V9.60.7.0   MAIN                                                              04/23/2024 19:04:13 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Obj\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE User\main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\App\24c02;.\App\iic;.\App\
                    -key;.\App\smg;.\Public;.\App\ds18b20;.\App\ds1302;.\App\ired;.\App\time;.\App\xpt2046) DEBUG OBJECTEXTEND PRINT(.\Obj\ma
                    -in.lst) TABS(2) OBJECT(.\Obj\main.obj)

line level    source

   1          #ifndef __DELAY_H__
   2          #define __DELAY_H__
   3          #ifndef __MATRIX_LED_H__
   4          #define __MATRIX_LED_H__
   5          
   6          #include "public.h"
   7          #include "smg.h"
   8          #include "xpt2046.h"
   9          #include <reg52.h>
  10          #include <stdio.h>
  11          #include <math.h>
  12          
  13          #define sound_velocity 34300    /* sound velocity in cm per second */
  14          
  15          #define period_in_us pow(10,-6)
  16          #define Clock_period 1.085*period_in_us   /* period for clock cycle of 8051*/
  17          
  18          void Delay(unsigned int xms);
  19          void MatrixLED_Init();
  20          void MatrixLED_ShowColumn(unsigned char Column,Data);
  21          
  22          void Delay(unsigned int xms)
  23          {
  24   1        unsigned char i, j;
  25   1        while(xms--)
  26   1        {
  27   2          i = 2;
  28   2          j = 239;
  29   2          do
  30   2          {
  31   3            while (--j);
  32   3          } while (--i);
  33   2        }
  34   1      }
  35          
  36          
  37          
  38          sbit Trigger_pin=P3^5;          /* Trigger pin */
  39          sbit Echo_pin=P3^3;   /* Echo pin */
  40          
  41          sbit SCK=P3^6;    //SRCLK
  42          sbit SER=P3^4;    //SER
  43          sbit motor = P1^0;
  44          sbit k3 = P3^2;
  45          
  46          #define MATRIX_LED_PORT   P0
  47          
  48          void _74HC595_WriteByte(unsigned char Byte)
  49          {
  50   1        unsigned char i;
  51   1        for(i=0;i<8;i++)
  52   1        {
  53   2          SER=Byte&(0x80>>i);
C51 COMPILER V9.60.7.0   MAIN                                                              04/23/2024 19:04:13 PAGE 2   

  54   2          SCK=1;
  55   2          SCK=0;
  56   2        }
  57   1        Trigger_pin=1;
  58   1        Trigger_pin=0;
  59   1      }
  60          
  61          void MatrixLED_Init()
  62          {
  63   1        SCK=0;
  64   1        Trigger_pin=0;
  65   1      }
  66          
  67          void MatrixLED_ShowColumn(unsigned char Column,Data)
  68          {
  69   1        _74HC595_WriteByte(Data);
  70   1        MATRIX_LED_PORT=~(0x80>>Column);
  71   1        Delay(1);
  72   1        MATRIX_LED_PORT=0xFF;
  73   1      }
  74          
  75          void Delay_us()
  76          {
  77   1        TL0=0xF5;
  78   1        TH0=0xFF;
  79   1        TR0=1;
  80   1        while (TF0==0);
  81   1        TR0=0;
  82   1        TF0=0;
  83   1      }
  84          
  85          void init_timer(){
  86   1        TMOD=0x01;                    /*initialize Timer*/
  87   1        TF0=0;
  88   1        TR0 = 0;
  89   1      }
  90          
  91          void send_trigger_pulse(){
  92   1        Trigger_pin= 1;             /* pull trigger pin HIGH */
  93   1        Delay_us();                 /* provide 10uS Delay*/
  94   1        Trigger_pin = 0;            /* pull trigger pin LOW*/
  95   1      }
  96          
  97          unsigned char code Animation[]={
  98            0xE7,0xE7,0xE7,0xFF,0xFF,0xE7,0xE7,0xE7,
  99            0xFE,0xC1,0xC1,0xFE,0xFE,0xC1,0xC1,0xFE,
 100            0xC3,0xC6,0xCC,0xF8,0xF8,0xCC,0xC6,0xC3,
 101            0xFF,0xFF,0xFF,0xE7,0xE7,0xE7,0xE7,0xE7,
 102            0xFF,0xFF,0x18,0xFF,0xFF,0x18,0xFF,0xFF,
 103            0x84,0xBF,0x9F,0x95,0x9F,0xC4,0xBF,0x84,
 104          };
 105          
 106          void main()
 107          {
 108   1        float value;
 109   1        unsigned char distance_in_cm[10];
 110   1        u16 distance_measurement=0;
 111   1        u8 buf[4];
 112   1        u16 i=0;
 113   1        u16 j=0;
 114   1        u16 Offset=0;
 115   1        u16 Count=0;
C51 COMPILER V9.60.7.0   MAIN                                                              04/23/2024 19:04:13 PAGE 3   

 116   1        MatrixLED_Init();
 117   1        motor = 0;
 118   1        for(j=0;j<700;j++) {
 119   2          for(i=0;i<8;i++)
 120   2          {
 121   3            MatrixLED_ShowColumn(i,Animation[i+Offset]);
 122   3          }
 123   2          Count++;
 124   2          if(Count>39)
 125   2          {
 126   3            Count=0;
 127   3            Offset+=8;
 128   3            if(Offset>41)
 129   3            {
 130   4              Offset=0;
 131   4            }
 132   3          }
 133   2        }
 134   1        init_timer();     /* Initialize Timer*/
 135   1        while(1)
 136   1        {   
 137   2          
 138   2          for(j=0;j<65535;j++) {
 139   3          send_trigger_pulse();     /* send trigger pulse of 10us */
 140   3          
 141   3          while(!Echo_pin);               /* Waiting for Echo */
 142   3          TR0 = 1;                        /* Timer Starts */
 143   3              while(Echo_pin && !TF0);        /* Waiting for Echo goes LOW */
 144   3              TR0 = 0;                        /* Stop the timer */
 145   3          
 146   3          /* calculate distance using timer */
 147   3          value = Clock_period * sound_velocity; 
 148   3          distance_measurement = (TL0|(TH0<<8));  /* read timer register for time count */
 149   3          distance_measurement = (distance_measurement*value)/2.0;  /* find distance(in cm) */
 150   3            if (distance_measurement < 5) {
 151   4              motor = 1;
 152   4            }
 153   3              
 154   3        
 155   3          buf[0]=gsmg_code[distance_measurement/1000];
 156   3          buf[1]=gsmg_code[distance_measurement%1000/100];
 157   3          buf[2]=gsmg_code[distance_measurement%1000%100/10];
 158   3          buf[3]=gsmg_code[distance_measurement%1000%100%10];
 159   3          smg_display(buf,5);
 160   3          }
 161   2      }
 162   1      }
*** WARNING C280 IN LINE 109 OF User\main.c: 'distance_in_cm': unreferenced local variable
 163          
 164          //void Int0() interrupt 0
 165          //{
 166              //motor = ~motor;
 167          //}
*** WARNING C316 IN LINE 167 OF User\main.c: unterminated conditionals


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    547    ----
   CONSTANT SIZE    =     48    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      28
C51 COMPILER V9.60.7.0   MAIN                                                              04/23/2024 19:04:13 PAGE 4   

   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  2 WARNING(S),  0 ERROR(S)
