C51 COMPILER V9.60.7.0   XPT2046                                                           04/12/2024 15:21:16 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE XPT2046
OBJECT MODULE PLACED IN .\Obj\xpt2046.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE App\xpt2046\xpt2046.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\App\24c02;.\App\
                    -iic;.\App\key;.\App\smg;.\Public;.\App\ds18b20;.\App\ds1302;.\App\ired;.\App\time;.\App\xpt2046) DEBUG OBJECTEXTEND PRIN
                    -T(.\Obj\xpt2046.lst) TABS(2) OBJECT(.\Obj\xpt2046.obj)

line level    source

   1          #include "xpt2046.h"
   2          #include "intrins.h"
   3          
   4          void xpt2046_wirte_data(u8 dat)
   5          {
   6   1        u8 i;
   7   1      
   8   1        CLK = 0;
   9   1        _nop_();
  10   1        for(i=0;i<8;i++)//repeat 8 times for a byte
  11   1        {
  12   2          DIN = dat >> 7;//MSB first
  13   2          dat <<= 1;//shift after one transfer
  14   2          CLK = 0;//generate a rising edge on CLK to write data_
  15   2          _nop_();  
  16   2          CLK = 1;
  17   2          _nop_();
  18   2        }
  19   1      }
  20          
  21          /*******************************************************************************
  22          *: xpt2046_read_data
  23          *******************************************************************************/
  24          u16 xpt2046_read_data(void)
  25          {
  26   1        u8 i;
  27   1        u16 dat=0;
  28   1      
  29   1        CLK = 0;
  30   1        _nop_();
  31   1        for(i=0;i<12;i++)//repeat for 12 times for 12-bit_ data_ reading
  32   1        {
  33   2          dat <<= 1;
  34   2          CLK = 1;
  35   2          _nop_();
  36   2          CLK = 0; //generate a falling edge on CLK to read data_
  37   2          _nop_();
  38   2          dat |= DOUT;//read MSB first
  39   2        }
  40   1        return dat; 
  41   1      }
  42          
  43          /*******************************************************************************
  44          *xpt2046_read_adc_value
  45          ********************************************************************************/
  46          u16 xpt2046_read_adc_value(u8 cmd)
  47          {
  48   1        u8 i;
  49   1        u16 adc_value=0;
  50   1      
  51   1        CLK = 0;//clock low
  52   1        CS  = 0;//chip select
  53   1        xpt2046_wirte_data(cmd);//send a command
C51 COMPILER V9.60.7.0   XPT2046                                                           04/12/2024 15:21:16 PAGE 2   

  54   1        for(i=6; i>0; i--);//delay for a while for the conversion
  55   1        CLK = 1;
  56   1        _nop_();
  57   1        CLK = 0;//clear the busy flag
  58   1        _nop_();
  59   1        adc_value=xpt2046_read_data();
  60   1        CS = 1;//deselect the chip
  61   1        return adc_value;
  62   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     88    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
